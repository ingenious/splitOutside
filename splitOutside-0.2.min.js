(function(){var q=this,m=function(b){return b.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")},n={splitOutside:function(b,l,a,h){var c,k="===-===",m={splitOutside:this.splitOutside,parseExpression:this.parseExpression};if("string"===typeof b&&"string"===typeof l||this.constructor!==String&&"string"===typeof b)c=b,b=l,l=a,a=h;else if(this.constructor!==String){if("string"!==typeof b&&b.constructor!==String)throw Error("Must specify String to be parsed");}else c=this.toString();if(!b||"string"!==typeof b)return[c];
a&&"string"===typeof a||(a="-"!==b?"==---==":"==~~~==");if(void 0===l&&!m.parseExpression)throw Error("splitOutside depnds on parseExpression");if(void 0!==l&&!m.parseExpression)throw Error("splitOutside depnds on parseExpression");h="\\"+b.split("").join("\\");k="-"!==b?"===-===":"===~===";a=a.replace(b,"~");c=c.replace(RegExp("("+h+')(?=(?:[^"]|"[^"]*")*$)',"g"),k).replace(RegExp(h,"g"),a).replace(RegExp(k,"g"),b).replace(RegExp("("+h+")(?=(?:[^']|'[^']*')*$)","g"),k).replace(RegExp(h,"g"),a).replace(RegExp(k,
"g"),b).replace(RegExp(h+"(?=[^[\\]]*?\\])","g"),a).replace(RegExp(h+"(?=[^{}]*?})","g"),a).replace(RegExp(h+"(?=[^()]*?\\))","g"),a);c=c.split(b);for(var e in c)c[e]=c[e].replace(RegExp(a,"g"),b),"undefined"!==typeof l&&(c[e]=m.parseExpression(c[e],l));return c},parseExpression:function(b,l){var a,h={splitOutside:this.splitOutside,parseExpression:this.parseExpression};if(!h.splitOutside)throw Error("parseExpression depends on splitOutside");if(this.constructor!==String&&"string"===typeof b)a=b,b=
l;else{if(this.constructor!==String)throw Error("Must specify string to be parsed");a=this.toString()}return function(c){var k,a="<= < >= > && || === == !== != - + % * /".split(" "),e=function(d){var c,g=[];d=m(d);/\)$/.test(d)&&-1!==d.indexOf("(")&&(c=d.substr(d.indexOf("(")),d=d.substr(0,d.indexOf("(")),g=(g=m(c.replace(/[()]/g,"")))?h.splitOutside(g,",",b):[]);if(b&&d in b)return"function"===typeof b[d]&&c?b[d].apply(b,g):b[d];if(q&&d in q)return"function"===typeof q[d]&&c?q[d].apply(b,g):q[d];
try{return JSON.parse(d)}catch(a){if(/^'(.*?)'$/.test(d))return JSON.parse(d.replace(/^'(.*?)'$/,'"$1"'));if(/^\{(.*?)\:(.*?)\}$/.test(d.replace(/\n|\r/g,""))){c=!0;var g={},f;d=d.replace(/\n|\r/g,"").replace(/^\{(.*?)\}$/,"$1");f=h.splitOutside(d,",");for(var k in f){var e=h.splitOutside(f[k],":",b);2!==e.length||"string"!==typeof e[0]?c=!1:g[e[0]]=e[1]}if(c)return g}else if(/^\[(.*?),(.*?)\]$/.test(d.replace(/\n|\r/g,"")))return d=d.replace(/\n|\r/g,"").replace(/^\[(.*?)\]$/,"$1"),h.splitOutside(d,
",",b);try{return JSON.parse('"'+d+'"')}catch(l){}}},l=function(c,e){var g,a,f=m(e);/^\([^()]+\)$/.test(f)&&(f=f.substr(1,f.length-2));a=h.splitOutside(f,c);if(a.length-1){f=h.parseExpression(a.shift(),b);a=h.parseExpression(a.join(c),b);if("boolean"!==typeof f&&"number"!==typeof f||"boolean"!==typeof a&&"number"!==typeof a)return;switch(c){case "/":g=f/a;break;case "*":g=f*a;break;case "%":g=f%a;break;case "+":g=f+a;break;case "-":g=f-a;break;case "<":g=f<a;break;case ">":g=f>a;break;case "<=":g=
f<=a;break;case ">=":g=f>=a;break;case "===":case "==":g=f===a;break;case "!==":case "!=":g=f!==a;break;case "&&":g=f&&a;break;case "||":g=f||a}}return g},p;for(p in a)if(-1!==c.indexOf(a[p])&&(k=l(a[p],c),"undefined"!==typeof k))break;if(void 0!==k)return k;k=h.splitOutside(c,".");if(1===k.length)return e(m(c));var n,r;if("object"===typeof h.parseExpression(k[0],b))c=h.parseExpression(k[0],b);else return e(m(c));k.shift();for(p in k)if(e=k[p],p==k.length-1&&-1!==e.indexOf("(")&&(n=e.substr(e.lastIndexOf("(")),
r=(r=m(n.replace(/^\(|\)$/g,"")))?h.splitOutside(r,",",b):[],e=m(e.substr(0,e.indexOf("(")))),e in c)if("function"===typeof c[e]&&n){c=c[e].apply(b,r);break}else c=c[e];return c}.apply(b,[a])}};this.define&&this.define.amd&&"function"===typeof this.define?define([],function(){return n}):void 0!==exports&&void 0!==module&&module.exports?exports=module.exports=n:(String.prototype.splitOutside=n.splitOutside,String.prototype.parseExpression=n.parseExpression)})();
